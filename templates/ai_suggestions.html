{% extends 'base.html' %}

{% block title %}AIåˆ†æä¸å»ºè®® - æŠ–éŸ³æ•°æ®åˆ†æç³»ç»Ÿ{% endblock %}

{% block page_title %}çŸ­è§†é¢‘AIåˆ†æä¸å»ºè®®{% endblock %}

{% block extra_css %}
<style>
    .ai-section {
        margin-bottom: 32px;
    }

    .chat-container {
        max-height: 500px;
        overflow-y: auto;
        border: 1px solid #e5e7eb;
        border-radius: 8px;
        padding: 20px;
        background: #fafafa;
        margin-bottom: 20px;
    }

    .chat-message {
        margin-bottom: 16px;
        padding: 12px 16px;
        border-radius: 8px;
        max-width: 80%;
        line-height: 1.6;
    }

    .chat-message.user {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        margin-left: auto;
    }

    .chat-message.ai {
        background: white;
        color: #333;
        border: 1px solid #e5e7eb;
    }

    .chat-input-container {
        display: flex;
        gap: 12px;
        align-items: flex-end;
    }

    .chat-textarea {
        flex: 1;
        min-height: 80px;
        padding: 12px;
        border: 1px solid #ddd;
        border-radius: 8px;
        font-family: inherit;
        font-size: 14px;
        resize: vertical;
    }

    .chat-textarea:focus {
        outline: none;
        border-color: #667eea;
    }

    .video-selector-container {
        display: flex;
        gap: 12px;
        align-items: center;
        margin-bottom: 20px;
    }

    .video-selector {
        flex: 1;
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 6px;
        font-size: 14px;
    }

    .typing-indicator {
        display: inline-flex;
        gap: 4px;
    }

    .typing-indicator span {
        width: 8px;
        height: 8px;
        background: #667eea;
        border-radius: 50%;
        animation: typing 1.4s infinite;
    }

    .typing-indicator span:nth-child(2) {
        animation-delay: 0.2s;
    }

    .typing-indicator span:nth-child(3) {
        animation-delay: 0.4s;
    }

    @keyframes typing {
        0%, 60%, 100% { transform: translateY(0); }
        30% { transform: translateY(-10px); }
    }

    .suggestion-cards {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 16px;
        margin-bottom: 24px;
    }

    .suggestion-card {
        background: white;
        padding: 20px;
        border-radius: 8px;
        border: 1px solid #e5e7eb;
        cursor: pointer;
        transition: all 0.3s ease;
    }

    .suggestion-card:hover {
        border-color: #667eea;
        box-shadow: 0 4px 12px rgba(102, 126, 234, 0.15);
        transform: translateY(-2px);
    }

    .suggestion-icon {
        font-size: 32px;
        margin-bottom: 12px;
    }

    .suggestion-title {
        font-size: 16px;
        font-weight: 600;
        color: #333;
        margin-bottom: 8px;
    }

    .suggestion-desc {
        font-size: 14px;
        color: #666;
        line-height: 1.6;
    }

    .analysis-result {
        background: #f0fdf4;
        border: 1px solid #86efac;
        border-radius: 8px;
        padding: 16px;
        margin-top: 16px;
    }

    .analysis-result.error {
        background: #fef2f2;
        border-color: #fca5a5;
    }

    .analysis-result h4 {
        color: #166534;
        margin-bottom: 12px;
        font-size: 16px;
    }

    .analysis-result.error h4 {
        color: #dc2626;
    }

    .analysis-content {
        color: #374151;
        line-height: 1.8;
        white-space: pre-wrap;
    }

    .model-info {
        background: #eff6ff;
        border: 1px solid #bfdbfe;
        border-radius: 6px;
        padding: 12px;
        margin-bottom: 20px;
    }

    .model-info p {
        margin: 4px 0;
        color: #1e40af;
        font-size: 13px;
    }
</style>
{% endblock %}

{% block content %}
<div class="page-header">
    <h2>çŸ­è§†é¢‘AIåˆ†æä¸å»ºè®®</h2>
    <p>ä½¿ç”¨è±†åŒ…1.6æ·±åº¦æ€è€ƒæ¨¡å‹è¿›è¡Œæ™ºèƒ½åˆ†æ</p>
</div>

<div class="model-info">
    <p><strong>å½“å‰æ¨¡å‹ï¼š</strong>doubao-seed-1-6-thinking-250715 (æ·±åº¦æ€è€ƒæ¨¡å‹)</p>
    <p><strong>æ¨¡å‹ç‰¹ç‚¹ï¼š</strong>å…·å¤‡æ·±åº¦æ¨ç†èƒ½åŠ›ï¼Œé€‚åˆå¤æ‚ä»»åŠ¡çš„åˆ†æä¸å»ºè®®</p>
    <p><strong>æ€è€ƒæ¨¡å¼ï¼š</strong>å·²å¯ç”¨ï¼Œæ¨¡å‹ä¼šè¿›è¡Œæ·±åº¦æ€è€ƒåç»™å‡ºä¸“ä¸šå»ºè®®</p>
</div>

<div class="suggestion-cards">
    <div class="suggestion-card" onclick="useSuggestion('content')">
        <div class="suggestion-icon">ğŸ“</div>
        <div class="suggestion-title">å†…å®¹ä¼˜åŒ–å»ºè®®</div>
        <div class="suggestion-desc">æ ¹æ®è§†é¢‘æ•°æ®åˆ†æå†…å®¹è¡¨ç°ï¼Œæä¾›ä¼˜åŒ–å»ºè®®</div>
    </div>

    <div class="suggestion-card" onclick="useSuggestion('trending')">
        <div class="suggestion-icon">ğŸ”¥</div>
        <div class="suggestion-title">çƒ­é—¨è¶‹åŠ¿åˆ†æ</div>
        <div class="suggestion-desc">åˆ†æå½“å‰çƒ­é—¨è§†é¢‘çš„ç‰¹ç‚¹å’Œè¶‹åŠ¿</div>
    </div>

    <div class="suggestion-card" onclick="useSuggestion('engagement')">
        <div class="suggestion-icon">ğŸ“Š</div>
        <div class="suggestion-title">äº’åŠ¨ç‡æå‡</div>
        <div class="suggestion-desc">æä¾›æå‡ç”¨æˆ·äº’åŠ¨ç‡çš„ç­–ç•¥å»ºè®®</div>
    </div>

    <div class="suggestion-card" onclick="useSuggestion('schedule')">
        <div class="suggestion-icon">â°</div>
        <div class="suggestion-title">æœ€ä½³å‘å¸ƒæ—¶é—´</div>
        <div class="suggestion-desc">åˆ†ææœ€ä½³å‘å¸ƒæ—¶é—´æ®µ</div>
    </div>
</div>

<div class="card ai-section">
    <h3 class="card-title">é€‰æ‹©è§†é¢‘è¿›è¡ŒAIåˆ†æ</h3>
    <div class="video-selector-container">
        <select id="ai-video-select" class="video-selector">
            <option value="">è¯·é€‰æ‹©è§†é¢‘</option>
        </select>
        <button class="btn btn-primary" onclick="analyzeVideo()">æ·±åº¦åˆ†æ</button>
    </div>

    <div id="ai-analysis-result" style="display: none;"></div>
</div>

<div class="card ai-section">
    <h3 class="card-title">AIæ™ºèƒ½å¯¹è¯</h3>
    <p style="color: #666; margin-bottom: 16px; font-size: 14px;">
        ä¸AIåŠ©æ‰‹è¿›è¡Œå¯¹è¯ï¼Œè·å–ä¸ªæ€§åŒ–çš„å†…å®¹å»ºè®®ã€æ•°æ®åˆ†ææ´å¯Ÿç­‰ã€‚
    </p>

    <div id="chat-container" class="chat-container">
        <div class="chat-message ai">
            ä½ å¥½ï¼æˆ‘æ˜¯æŠ–éŸ³æ•°æ®åˆ†æAIåŠ©æ‰‹ã€‚æˆ‘å¯ä»¥å¸®åŠ©ä½ åˆ†æè§†é¢‘è¡¨ç°ã€æä¾›å†…å®¹ä¼˜åŒ–å»ºè®®ã€åˆ†æçƒ­é—¨è¶‹åŠ¿ç­‰ã€‚è¯·é€‰æ‹©ä¸€ä¸ªè§†é¢‘è¿›è¡Œåˆ†æï¼Œæˆ–è€…ç›´æ¥å‘æˆ‘æé—®ï¼
        </div>
    </div>

    <div class="chat-input-container">
        <textarea
            id="chat-input"
            class="chat-textarea"
            placeholder="è¾“å…¥ä½ çš„é—®é¢˜æˆ–éœ€è¦åˆ†æçš„å†…å®¹..."
            onkeydown="if(event.key === 'Enter' && !event.shiftKey){event.preventDefault();sendMessage();}"
        ></textarea>
        <button class="btn btn-primary" onclick="sendMessage()" id="send-btn">å‘é€</button>
    </div>
</div>

<div class="card">
    <h3 class="card-title">åŠŸèƒ½è¯´æ˜</h3>
    <div style="color: #666; line-height: 1.8;">
        <p><strong>1. æ·±åº¦åˆ†æåŠŸèƒ½ï¼š</strong>é€‰æ‹©è§†é¢‘åï¼ŒAIä¼šåŸºäºè§†é¢‘çš„å„é¡¹æ•°æ®ï¼ˆç‚¹èµã€è¯„è®ºã€æ”¶è—ã€åˆ†äº«ç­‰ï¼‰è¿›è¡Œæ·±åº¦åˆ†æï¼Œæä¾›è¯¦ç»†çš„å†…å®¹å»ºè®®ã€‚</p>
        <p><strong>2. æ™ºèƒ½å¯¹è¯ï¼š</strong>å¯ä»¥éšæ—¶ä¸AIåŠ©æ‰‹å¯¹è¯ï¼Œè¯¢é—®å…³äºæŠ–éŸ³è¿è¥ã€å†…å®¹åˆ›ä½œã€æ•°æ®åˆ†æç­‰ä»»ä½•é—®é¢˜ã€‚</p>
        <p><strong>3. æ¨¡å‹ä¼˜åŠ¿ï¼š</strong>è±†åŒ…1.6æ·±åº¦æ€è€ƒæ¨¡å‹å…·å¤‡å¼ºå¤§çš„æ¨ç†èƒ½åŠ›ï¼Œèƒ½å¤Ÿç»“åˆå¤šä¸ªç»´åº¦ç»™å‡ºä¸“ä¸šçš„åˆ†æå’Œå»ºè®®ã€‚</p>
        <p><strong>4. ä½¿ç”¨å»ºè®®ï¼š</strong>ä¸ºäº†è·å¾—æ›´å¥½çš„åˆ†æç»“æœï¼Œå»ºè®®å…ˆé€‰æ‹©ä¸€ä¸ªè§†é¢‘è¿›è¡Œæ·±åº¦åˆ†æï¼Œç„¶åå†è¿›è¡Œå¯¹è¯äº¤æµã€‚</p>
    </div>
</div>

<script>
    let chatHistory = [];

    // åŠ è½½è§†é¢‘åˆ—è¡¨
    function loadVideoList() {
        fetch('/api/video-list/')
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    const select = document.getElementById('ai-video-select');
                    select.innerHTML = '<option value="">è¯·é€‰æ‹©è§†é¢‘</option>';
                    data.data.videos.forEach(video => {
                        const option = document.createElement('option');
                        option.value = video.aweme_id;
                        option.textContent = `${video.aweme_id} - ${video.description.substring(0, 30)}...`;
                        select.appendChild(option);
                    });
                }
            })
            .catch(error => console.error('åŠ è½½è§†é¢‘åˆ—è¡¨å¤±è´¥:', error));
    }

    // ä½¿ç”¨å»ºè®®å¡ç‰‡
    function useSuggestion(type) {
        const suggestions = {
            'content': 'è¯·å¸®æˆ‘åˆ†æè¿™ä¸ªè§†é¢‘çš„å†…å®¹è¡¨ç°ï¼Œå¹¶ç»™å‡ºä¼˜åŒ–å»ºè®®ã€‚',
            'trending': 'æ ¹æ®å½“å‰è§†é¢‘æ•°æ®ï¼Œåˆ†æä¸€ä¸‹çƒ­é—¨è¶‹åŠ¿å’Œç”¨æˆ·åå¥½ã€‚',
            'engagement': 'å¦‚ä½•æé«˜è¿™ä¸ªè§†é¢‘çš„äº’åŠ¨ç‡ï¼Ÿè¯·ç»™å‡ºå…·ä½“çš„ç­–ç•¥å»ºè®®ã€‚',
            'schedule': 'åˆ†æå‘å¸ƒæ—¶é—´å¯¹è§†é¢‘è¡¨ç°çš„å½±å“ï¼Œå»ºè®®æœ€ä½³çš„å‘å¸ƒæ—¶é—´æ®µã€‚'
        };

        const videoId = document.getElementById('ai-video-select').value;
        let message = suggestions[type];

        if (videoId) {
            message += ` è§†é¢‘ID: ${videoId}`;
        } else {
            message += 'ï¼ˆè¯·å…ˆé€‰æ‹©ä¸€ä¸ªè§†é¢‘ä»¥è·å¾—æ›´ç²¾å‡†çš„åˆ†æï¼‰';
        }

        document.getElementById('chat-input').value = message;
    }

    // æ·»åŠ æ¶ˆæ¯åˆ°èŠå¤©ç•Œé¢
    function addMessage(role, content) {
        const chatContainer = document.getElementById('chat-container');
        const messageDiv = document.createElement('div');
        messageDiv.className = `chat-message ${role}`;

        if (role === 'ai') {
            // AIæ¶ˆæ¯æ”¯æŒMarkdownæ ¼å¼
            messageDiv.innerHTML = formatMarkdown(content);
        } else {
            messageDiv.textContent = content;
        }

        chatContainer.appendChild(messageDiv);
        chatContainer.scrollTop = chatContainer.scrollHeight;
    }

    // æ˜¾ç¤ºè¾“å…¥æŒ‡ç¤ºå™¨
    function showTypingIndicator() {
        const chatContainer = document.getElementById('chat-container');
        const typingDiv = document.createElement('div');
        typingDiv.id = 'typing-indicator';
        typingDiv.className = 'chat-message ai';
        typingDiv.innerHTML = '<div class="typing-indicator"><span></span><span></span><span></span></div>';
        chatContainer.appendChild(typingDiv);
        chatContainer.scrollTop = chatContainer.scrollHeight;
    }

    // ç§»é™¤è¾“å…¥æŒ‡ç¤ºå™¨
    function removeTypingIndicator() {
        const typingIndicator = document.getElementById('typing-indicator');
        if (typingIndicator) {
            typingIndicator.remove();
        }
    }

    // å‘é€æ¶ˆæ¯
    async function sendMessage() {
        const input = document.getElementById('chat-input');
        const message = input.value.trim();

        if (!message) {
            return;
        }

        // æ¸…ç©ºè¾“å…¥æ¡†
        input.value = '';

        // æ·»åŠ ç”¨æˆ·æ¶ˆæ¯
        addMessage('user', message);

        // æ˜¾ç¤ºåŠ è½½æŒ‡ç¤ºå™¨
        showTypingIndicator();

        try {
            // è·å–å½“å‰é€‰æ‹©çš„è§†é¢‘IDï¼ˆå¦‚æœæœ‰ï¼‰
            const videoId = document.getElementById('ai-video-select').value;

            // æ„å»ºè¯·æ±‚
            const response = await fetch('/api/ai-chat/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    message: message,
                    video_id: videoId
                })
            });

            const data = await response.json();

            // ç§»é™¤åŠ è½½æŒ‡ç¤ºå™¨
            removeTypingIndicator();

            if (data.success) {
                addMessage('ai', data.data.response);
            } else {
                addMessage('ai', `æŠ±æ­‰ï¼Œåˆ†æå¤±è´¥ï¼š${data.error}`);
            }
        } catch (error) {
            console.error('å‘é€æ¶ˆæ¯å¤±è´¥:', error);
            removeTypingIndicator();
            addMessage('ai', 'æŠ±æ­‰ï¼Œç½‘ç»œé”™è¯¯ï¼Œè¯·ç¨åé‡è¯•ã€‚');
        }
    }

    // åˆ†æè§†é¢‘
    async function analyzeVideo() {
        const videoId = document.getElementById('ai-video-select').value;

        if (!videoId) {
            alert('è¯·é€‰æ‹©ä¸€ä¸ªè§†é¢‘');
            return;
        }

        const resultDiv = document.getElementById('ai-analysis-result');
        resultDiv.style.display = 'block';
        resultDiv.innerHTML = '<div class="loading"><div class="loading-spinner"></div>AIæ­£åœ¨æ·±åº¦åˆ†æä¸­ï¼Œè¯·ç¨å€™...</div>';

        // åŒæ—¶åœ¨èŠå¤©ä¸­æ˜¾ç¤ºåˆ†æè¯·æ±‚
        addMessage('user', `è¯·æ·±åº¦åˆ†æè§†é¢‘ ${videoId} çš„è¡¨ç°å¹¶æä¾›ä¼˜åŒ–å»ºè®®ã€‚`);
        showTypingIndicator();

        try {
            const response = await fetch('/api/ai-analyze-video/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    video_id: videoId
                })
            });

            const data = await response.json();

            removeTypingIndicator();

            if (data.success) {
                // æ ¼å¼åŒ–åˆ†æç»“æœ
                const analysisText = formatAnalysisResult(data.data);

                // æ˜¾ç¤ºåˆ†æç»“æœ
                resultDiv.innerHTML = `
                    <div class="analysis-result">
                        <h4>ğŸ¯ AIæ·±åº¦åˆ†æç»“æœ</h4>
                        <div class="analysis-content">${formatMarkdown(analysisText)}</div>
                    </div>
                `;

                // åŒæ—¶åœ¨èŠå¤©ä¸­æ˜¾ç¤º
                addMessage('ai', analysisText);
            } else {
                resultDiv.innerHTML = `
                    <div class="analysis-result error">
                        <h4>âŒ åˆ†æå¤±è´¥</h4>
                        <p>${data.error}</p>
                    </div>
                `;
                addMessage('ai', `åˆ†æå¤±è´¥ï¼š${data.error}`);
            }
        } catch (error) {
            console.error('åˆ†æè§†é¢‘å¤±è´¥:', error);
            removeTypingIndicator();
            resultDiv.innerHTML = `
                <div class="analysis-result error">
                    <h4>âŒ åˆ†æå¤±è´¥</h4>
                    <p>ç½‘ç»œé”™è¯¯ï¼Œè¯·ç¨åé‡è¯•</p>
                </div>
            `;
            addMessage('ai', 'åˆ†æå¤±è´¥ï¼šç½‘ç»œé”™è¯¯ï¼Œè¯·ç¨åé‡è¯•ã€‚');
        }
    }

    // æ ¼å¼åŒ–åˆ†æç»“æœä¸ºå¯è¯»æ–‡æœ¬
    function formatAnalysisResult(data) {
        let result = '';

        if (data.content_positioning) {
            result += '### ğŸ“Œ å†…å®¹å®šä½åˆ†æ\n\n';
            if (data.content_positioning.theme) {
                result += `**ä¸»é¢˜**: ${data.content_positioning.theme}\n\n`;
            }
            if (data.content_positioning.target_audience) {
                result += `**ç›®æ ‡å—ä¼—**: ${data.content_positioning.target_audience}\n\n`;
            }
            if (data.content_positioning.uniqueness) {
                result += `**ç‹¬ç‰¹æ€§**: ${data.content_positioning.uniqueness}\n\n`;
            }
        }

        if (data.data_analysis) {
            result += '### ğŸ“Š æ•°æ®è¡¨ç°åˆ†æ\n\n';
            if (data.data_analysis.like_rate_comment) {
                result += `- ç‚¹èµç‡: ${data.data_analysis.like_rate_comment}\n`;
            }
            if (data.data_analysis.comment_rate_comment) {
                result += `- è¯„è®ºç‡: ${data.data_analysis.comment_rate_comment}\n`;
            }
            if (data.data_analysis.share_rate_comment) {
                result += `- åˆ†äº«ç‡: ${data.data_analysis.share_rate_comment}\n`;
            }
            if (data.data_analysis.collect_rate_comment) {
                result += `- æ”¶è—ç‡: ${data.data_analysis.collect_rate_comment}\n`;
            }
            result += '\n';

            if (data.data_analysis.strengths && data.data_analysis.strengths.length > 0) {
                result += '**ä¼˜åŠ¿**:\n';
                data.data_analysis.strengths.forEach(item => {
                    result += `- ${item}\n`;
                });
                result += '\n';
            }

            if (data.data_analysis.weaknesses && data.data_analysis.weaknesses.length > 0) {
                result += '**çŸ­æ¿**:\n';
                data.data_analysis.weaknesses.forEach(item => {
                    result += `- ${item}\n`;
                });
                result += '\n';
            }
        }

        if (data.optimization_suggestions) {
            result += '### ğŸ’¡ ä¼˜åŒ–å»ºè®®\n\n';

            if (data.optimization_suggestions.title_suggestions && data.optimization_suggestions.title_suggestions.length > 0) {
                result += '**æ ‡é¢˜å»ºè®®**:\n';
                data.optimization_suggestions.title_suggestions.forEach(item => {
                    result += `- ${item}\n`;
                });
                result += '\n';
            }

            if (data.optimization_suggestions.publish_time) {
                result += `**å‘å¸ƒæ—¶é—´**: ${data.optimization_suggestions.publish_time}\n\n`;
            }

            if (data.optimization_suggestions.content_improvements && data.optimization_suggestions.content_improvements.length > 0) {
                result += '**å†…å®¹æ”¹è¿›**:\n';
                data.optimization_suggestions.content_improvements.forEach(item => {
                    result += `- ${item}\n`;
                });
                result += '\n';
            }

            if (data.optimization_suggestions.interaction_guidance && data.optimization_suggestions.interaction_guidance.length > 0) {
                result += '**äº’åŠ¨å¼•å¯¼**:\n';
                data.optimization_suggestions.interaction_guidance.forEach(item => {
                    result += `- ${item}\n`;
                });
                result += '\n';
            }
        }

        if (data.risk_assessment) {
            result += '### âš ï¸ é£é™©è¯„ä¼°\n\n';
            if (data.risk_assessment.sensitive_content) {
                result += `- æ•æ„Ÿå†…å®¹: ${data.risk_assessment.sensitive_content}\n`;
            }
            if (data.risk_assessment.copyright_risk) {
                result += `- ç‰ˆæƒé£é™©: ${data.risk_assessment.copyright_risk}\n`;
            }
            if (data.risk_assessment.violation_risk) {
                result += `- è¿è§„é£é™©: ${data.risk_assessment.violation_risk}\n`;
            }
            result += '\n';
        }

        if (data.overall_score !== undefined) {
            result += `### ğŸ“ˆ ç»¼åˆè¯„åˆ†: ${data.overall_score}/100\n\n`;
        }

        if (data.summary) {
            result += `### ğŸ“ æ€»ç»“\n${data.summary}\n`;
        }

        if (data.metrics) {
            result += '\n### ğŸ“‰ æ•°æ®æŒ‡æ ‡\n\n';
            result += `æ’­æ”¾é‡: ${data.metrics.view_count.toLocaleString()}\n`;
            result += `ç‚¹èµæ•°: ${data.metrics.like_count.toLocaleString()}\n`;
            result += `è¯„è®ºæ•°: ${data.metrics.comment_count.toLocaleString()}\n`;
            result += `åˆ†äº«æ•°: ${data.metrics.share_count.toLocaleString()}\n`;
            result += `æ”¶è—æ•°: ${data.metrics.collect_count.toLocaleString()}\n`;
            result += `äº’åŠ¨ç‡: ${data.metrics.interaction_rate}%\n`;
        }

        return result;
    }

    // ç®€å•çš„Markdownæ ¼å¼åŒ–
    function formatMarkdown(text) {
        // è½¬ä¹‰HTML
        text = text.replace(/&/g, '&amp;')
                   .replace(/</g, '&lt;')
                   .replace(/>/g, '&gt;');

        // æ ‡é¢˜
        text = text.replace(/^### (.*$)/gim, '<h3>$1</h3>');
        text = text.replace(/^## (.*$)/gim, '<h2>$1</h2>');
        text = text.replace(/^# (.*$)/gim, '<h1>$1</h1>');

        // ç²—ä½“
        text = text.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');

        // æ–œä½“
        text = text.replace(/\*(.*?)\*/g, '<em>$1</em>');

        // åˆ—è¡¨
        text = text.replace(/^- (.*$)/gim, '<li>$1</li>');
        text = text.replace(/(<li>.*<\/li>\n?)+/g, '<ul>$&</ul>');

        // æ¢è¡Œ
        text = text.replace(/\n/g, '<br>');

        return text;
    }

    // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
    document.addEventListener('DOMContentLoaded', function() {
        loadVideoList();
    });
</script>
{% endblock %}
